<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gast Kalender Offenbach</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVK+jJdG7y6Dq2T2n6m3hU7I6t0y7sC6XFvA6X/m0Pz06x3Vq5tA7M7O4x4E4S4C7x7D6y8A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }
        main {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }
        h1, h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }
        nav {
            background-color: #3f51b5;
            padding: 10px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        nav button {
            background-color: #5c6bc0;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        nav button:hover {
            background-color: #7986cb;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .month-nav button {
            background-color: #eee;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
        }
        table.calendar {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            table-layout: fixed;
        }
        table.calendar th, table.calendar td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            height: 30px;
            box-sizing: border-box;
            position: relative; /* Wichtig für die diagonale Linie */
        }
        table.calendar th {
            background-color: #f2f2f2;
        }
        table.calendar td {
            background-color: #fff;
            cursor: pointer;
        }
        table.calendar td.inactive {
            color: #ccc;
            background-color: #f9f9f9;
            cursor: default;
        }
        table.calendar td.booked {
            background-color: #ff5252;
            color: white;
        }
        table.calendar td.cancelled {
            background-color: #d1c4e9;
            color: white;
        }
        table.calendar td.blocked {
            background-color: #757575;
            color: white;
        }
        /* Neue CSS-Regeln für die diagonale Trennung */
        table.calendar td.booked-morning::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top right, white 49.5%, #ff5252 50.5%);
            z-index: 0;
        }
        table.calendar td.booked-afternoon::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top right, #ff5252 49.5%, white 50.5%);
            z-index: 0;
        }
        table.calendar td.booked-full {
            background-color: #ff5252;
            color: white;
        }
        table.calendar td.booked-split {
            background-color: #fff; /* Hintergrund bleibt weiß */
            color: #333;
        }
        table.calendar td.booked-split::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top right, #ff5252 49.5%, white 50.5%);
            z-index: 0;
        }
        /* End of neue CSS-Regeln */

        table.calendar td.selected-start,
        table.calendar td.selected-end,
        table.calendar td.selected-range {
            background-color: #81c784 !important;
            color: #fff !important;
        }
        table.calendar td > span {
            position: relative;
            z-index: 1;
        }

        #calendar-legend {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border: 1px solid #ddd;
        }
        #legend-color-available { background-color: white; }
        #legend-color-booked { background-color: #ff5252; border-color: #ff5252; }
        #legend-color-cancelled { background-color: #d1c4e9; border-color: #d1c4e9; }
        #legend-color-blocked { background-color: #757575; border-color: #757575; }
        #legend-color-selected { background-color: #81c784; border-color: #81c784; }
        #legend-color-split {
            background: white;
            border-color: #ddd;
            position: relative;
        }
        #legend-color-split::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top right, #ff5252 49.5%, white 50.5%);
        }


        #yearly-calendar-content, #admin-yearly-calendar-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        #yearly-calendar-content .calendar, #admin-yearly-calendar-content .calendar {
            font-size: 10px;
        }
        #yearly-calendar-content .calendar td, #admin-yearly-calendar-content .calendar td {
            padding: 5px;
            height: 25px;
            line-height: 15px;
        }
        #yearly-calendar-content .calendar td.tooltip, #admin-yearly-calendar-content .calendar td.tooltip {
            padding: 0;
            height: 25px;
            line-height: 25px;
        }
        #yearly-calendar-content .calendar .tooltiptext, #admin-yearly-calendar-content .calendar .tooltiptext {
            width: 80px;
            left: 50%;
            margin-left: -40px;
        }
        #admin-booking-form-container, #admin-edit-form-container, #waitlist-form-container {
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background-color: #f9f9f9;
        }

        form {
            max-width: 500px;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }
        input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }
        button {
            background-color: #3f51b5;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #5c6bc0;
        }
        .error-msg {
            color: red;
            text-align: center;
            margin-top: -10px;
            margin-bottom: 10px;
        }
        .info-msg {
            color: green;
            text-align: center;
            margin-top: -10px;
            margin-bottom: 10px;
        }
        #login-box {
            max-width: 400px;
            margin: 40px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        #login-box input {
            font-size: 1.2em;
            padding: 12px;
        }
        #login-box button {
            font-size: 1.2em;
            padding: 12px 20px;
        }
        #admin-bookings-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        #admin-bookings-list table, #admin-waitlist-list table {
            width: 100%;
            border-collapse: collapse;
        }
        #admin-bookings-list th, #admin-bookings-list td, #admin-waitlist-list th, #admin-waitlist-list td {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: center;
        }
        #admin-bookings-list th, #admin-waitlist-list th {
            background-color: #f2f2f2;
        }
        .icon {
            margin-right: 5px;
        }

        .tooltip {
          position: relative;
          display: block;
          width: 100%;
          height: 100%;
          pointer-events: none;
        }
        .tooltiptext {
          visibility: hidden;
          width: 120px;
          background-color: #555;
          color: #fff;
          text-align: center;
          border-radius: 6px;
          padding: 5px 0;
          position: absolute;
          z-index: 1;
          bottom: 125%;
          left: 50%;
          margin-left: -60px;
          opacity: 0;
          transition: opacity 0.3s;
          pointer-events: none;
        }
        td:hover .tooltiptext {
          visibility: visible;
          opacity: 1;
        }
        .tooltiptext::after {
          content: "";
          position: absolute;
          top: 100%;
          left: 50%;
          margin-left: -5px;
          border-width: 5px;
          border-style: solid;
          border-color: #555 transparent transparent transparent;
        }
        #notification-box {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            max-width: 300px;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        #notification-box.error { background-color: #f44336; }
        @keyframes fadein { from { opacity: 0; top: 0; } to { opacity: 1; top: 20px; } }
        @keyframes fadeout { from { opacity: 1; top: 20px; } to { opacity: 0; top: 0; } }

        /* Stilverbesserungen für Bestätigungen */
        .confirmation-box {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
        }
        .confirmation-box.error {
            background-color: #ffebee;
            border-color: #ffcdd2;
        }
        .confirmation-box h3 {
            color: #2e7d32;
        }
        .confirmation-box.error h3 {
            color: #c62828;
        }
        .confirmation-box p {
            font-size: 1.1em;
            line-height: 1.5;
        }
        .confirmation-box .details {
            background-color: #f1f8e9;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid #dcedc8;
        }
        .confirmation-box.error .details {
            background-color: #fbe9e7;
            border-color: #ffccbc;
        }
        .confirmation-box .details strong {
            display: inline-block;
            min-width: 150px;
        }
        .confirmation-box .button-group {
            margin-top: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        #admin-waitlist-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            #yearly-calendar-content, #admin-yearly-calendar-content {
                grid-template-columns: repeat(2, 1fr);
            }
            table.calendar th, table.calendar td {
                padding: 3px;
                font-size: 8px;
            }
            .container {
                padding: 10px;
            }
            nav {
                flex-direction: column;
            }
            nav button {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <nav>
        <button id="lang-de"><i class="fas fa-flag icon"></i> DE</button>
        <button id="lang-en"><i class="fas fa-flag icon"></i> EN</button>
        <button id="btn-to-start" style="display:none;"><i class="fas fa-home icon"></i> Startseite</button>
        <button id="btn-show-admin-login"><i class="fas fa-user-shield icon"></i> Admin Login</button>
    </nav>

    <div id="notification-box"></div>

    <main>
        <section id="start-page">
            <div class="container">
                <h1 data-lang-de="Willkommen in Offenbach!" data-lang-en="Welcome to Offenbach!">Willkommen in Offenbach!</h1>
                <p style="text-align:center;" data-lang-de="Ich freue mich auf deinen Besuch! Über den Kalender kannst du als Gast bequem eine Übernachtung buchen. Oder du meldest dich als Admin an, um den Kalender zu verwalten." data-lang-en="I'm looking forward to your visit! You can book an overnight stay as a guest via the calendar. Or you can log in as an admin to manage the calendar.">
                    Ich freue mich auf deinen Besuch! Über den Kalender kannst du als Gast bequem eine Übernachtung buchen. Oder du meldest dich als Admin an, um den Kalender zu verwalten.
                </p>
            </div>
            
            <div id="login-box">
                <h2 data-lang-de="Hier geht es zur Buchung" data-lang-en="Click here to book">Hier geht es zur Buchung</h2>
                <p data-lang-de="Bitte Passwort eingeben:" data-lang-en="Please enter your password:">Bitte Passwort eingeben:</p>
                <input type="password" id="friend-password" placeholder="Passwort" data-lang-placeholder-de="Passwort" data-lang-placeholder-en="Password" />
                <div id="friend-login-error" class="error-msg"></div>
                <button id="friend-login-btn" data-lang-de="Einloggen" data-lang-en="Login">Einloggen</button>
            </div>
        </section>

        <section id="friend-area" style="display:none;">
            <div class="container">
                <h2 data-lang-de="Jahreskalender (Gast-Ansicht)" data-lang-en="Yearly Calendar (Guest View)">Jahreskalender (Gast-Ansicht)</h2>
                <div style="text-align:center; margin-bottom: 10px;">
                    <button id="year-prev" data-lang-de="&lt; Vorjahr" data-lang-en="&lt; Previous Year">&lt; Vorjahr</button>
                    <span id="year-display" style="font-weight: 700; margin: 0 15px; font-size: 1.2em;"></span>
                    <button id="year-next" data-lang-de="Nächstes Jahr &gt;" data-lang-en="Next Year &gt;">Nächstes Jahr &gt;</button>
                </div>

                <div id="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-available"></div>
                        <span data-lang-de="Freie Tage" data-lang-en="Available Days">Freie Tage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-booked"></div>
                        <span data-lang-de="Gebuchte Tage (ganztägig)" data-lang-en="Booked Days (full)">Gebuchte Tage (ganztägig)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-split"></div>
                        <span data-lang-de="Halbtags belegt" data-lang-en="Half-day booked">Halbtags belegt</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-blocked"></div>
                        <span data-lang-de="Blockierte Tage" data-lang-en="Blocked Days">Blockierte Tage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-selected"></div>
                        <span data-lang-de="Ausgewählter Zeitraum" data-lang-en="Selected Period">Ausgewählter Zeitraum</span>
                    </div>
                </div>

                <div id="yearly-calendar-content"></div>
            </div>
            
            <form id="booking-form" style="display:none;">
                <h3 style="margin-top: 0;" data-lang-de="Buchungsdetails" data-lang-en="Booking Details">Buchungsdetails</h3>
                <div id="booking-summary-text" style="text-align:center; margin-bottom: 15px; font-weight:bold;"></div>
                <div>
                    <label for="book-name" data-lang-de="Name (Pflichtfeld)" data-lang-en="Name (Required)">Name (Pflichtfeld)</label>
                    <input type="text" id="book-name" required />
                </div>
                <div>
                    <label for="book-email" data-lang-de="E-Mail-Adresse (Pflichtfeld)" data-lang-en="E-Mail Address (Required)">E-Mail-Adresse (Pflichtfeld)</label>
                    <input type="email" id="book-email" required />
                </div>
                <div>
                    <label for="book-phone" data-lang-de="Mobilfunknummer (Pflichtfeld)" data-lang-en="Mobile Number (Required)">Mobilfunknummer (Pflichtfeld)</label>
                    <input type="tel" id="book-phone" required />
                </div>
                <div>
                    <label for="book-persons" data-lang-de="Anzahl Personen (max. 3)" data-lang-en="Number of people (max. 3)">Anzahl Personen (max. 3)</label>
                    <input type="number" id="book-persons" min="1" max="3" value="1" required />
                </div>
                <div>
                    <label for="book-start-date" data-lang-de="Startdatum" data-lang-en="Start Date">Startdatum</label>
                    <input type="date" id="book-start-date" required />
                </div>
                <div>
                    <label for="book-end-date" data-lang-de="Enddatum" data-lang-en="End Date">Enddatum</label>
                    <input type="date" id="book-end-date" required />
                </div>
                <div>
                    <label for="book-breakfast" data-lang-de="Frühstück benötigt?" data-lang-en="Breakfast needed?">Frühstück benötigt?</label>
                    <select id="book-breakfast" required>
                        <option value="ja" data-lang-de="Ja" data-lang-en="Yes">Ja</option>
                        <option value="nein" selected data-lang-de="Nein" data-lang-en="No">Nein</option>
                    </select>
                </div>
                <div>
                    <label for="book-arrival-time" data-lang-de="Anreise Uhrzeit (optional)" data-lang-en="Arrival Time (optional)">Anreise Uhrzeit (optional)</label>
                    <input type="time" id="book-arrival-time" />
                </div>
                <div>
                    <label for="book-departure-time" data-lang-de="Abreise Uhrzeit (optional)" data-lang-en="Departure Time (optional)">Abreise Uhrzeit (optional)</label>
                    <input type="time" id="book-departure-time" />
                </div>
                <div>
                    <label for="book-comment" data-lang-de="Bemerkungen (optional, max. 200 Zeichen)" data-lang-en="Comments (optional, max. 200 characters)">Bemerkungen (optional, max. 200 Zeichen)</label>
                    <textarea id="book-comment" maxlength="200"></textarea>
                </div>
                <div>
                    <label for="book-parking">
                        <input type="checkbox" id="book-parking"> <span data-lang-de="Parkplatz benötigt?" data-lang-en="Parking space needed?">Parkplatz benötigt?</span>
                    </label>
                </div>
                <div id="booking-error" class="error-msg"></div>
                <button type="submit" style="background-color: #4CAF50;" data-lang-de="Buchung abschicken" data-lang-en="Submit Booking">Buchung abschicken</button>
                <button type="button" id="btn-cancel-booking-form" style="background-color: #f44336;" data-lang-de="Abbrechen" data-lang-en="Cancel">Abbrechen</button>
            </form>
            
            <form id="waitlist-form-container" style="display:none;">
                <h3 data-lang-de="Auf die Warteliste setzen" data-lang-en="Join Waitlist">Auf die Warteliste setzen</h3>
                <p data-lang-de="Der gewählte Zeitraum ist leider bereits belegt. Sie können sich auf die Warteliste setzen lassen. Wir informieren Sie, wenn die Tage wieder frei werden." data-lang-en="The selected period is unfortunately already taken. You can join the waitlist. We will inform you if the days become free again."></p>
                <div>
                    <label for="waitlist-name" data-lang-de="Name (Pflichtfeld)" data-lang-en="Name (Required)">Name (Pflichtfeld)</label>
                    <input type="text" id="waitlist-name" required />
                </div>
                <div>
                    <label for="waitlist-email" data-lang-de="E-Mail-Adresse (Pflichtfeld)" data-lang-en="E-Mail Address (Required)">E-Mail-Adresse (Pflichtfeld)</label>
                    <input type="email" id="waitlist-email" required />
                </div>
                <div id="waitlist-error" class="error-msg"></div>
                <button type="submit" data-lang-de="Auf Warteliste setzen" data-lang-en="Join Waitlist">Auf Warteliste setzen</button>
                <button type="button" id="btn-cancel-waitlist-form" style="background-color: #f44336;" data-lang-de="Abbrechen" data-lang-en="Cancel">Abbrechen</button>
            </form>

            <div id="booking-success" class="container confirmation-box" style="display:none;">
                <h3 data-lang-de="Buchung erfolgreich!" data-lang-en="Booking successful!">Buchung erfolgreich!</h3>
                <p data-lang-de="Ihre Buchungsdetails wurden gespeichert. Sie erhalten in Kürze eine Bestätigung per E-Mail." data-lang-en="Your booking details have been saved. You will receive a confirmation email shortly.">Ihre Buchungsdetails wurden gespeichert. Sie erhalten in Kürze eine Bestätigung per E-Mail.</p>
                <div id="success-details" class="details"></div>
                <div class="button-group">
                    <button id="btn-export-ical" style="background-color: #00796b;"><i class="fas fa-calendar-alt icon"></i> <span data-lang-de="Zum Kalender hinzufügen" data-lang-en="Add to Calendar">Zum Kalender hinzufügen</span></button>
                    <button id="btn-new-booking" data-lang-de="Neue Buchung" data-lang-en="New Booking">Neue Buchung</button>
                    <button id="btn-return-home-from-booking" data-lang-de="Zurück zur Startseite" data-lang-en="Back to Homepage">Zurück zur Startseite</button>
                </div>
            </div>
        </section>

        <section id="admin-login" style="display:none;">
            <div id="login-box">
                <h2 data-lang-de="Admin Login" data-lang-en="Admin Login">Admin Login</h2>
                <p data-lang-de="Bitte Admin-Passwort eingeben:" data-lang-en="Please enter the admin password:">Bitte Admin-Passwort eingeben:</p>
                <input type="password" id="admin-password" placeholder="Admin Passwort" data-lang-placeholder-de="Admin Passwort" data-lang-placeholder-en="Admin Password" />
                <div id="admin-login-error" class="error-msg"></div>
                <button id="admin-login-btn" data-lang-de="Einloggen" data-lang-en="Login">Einloggen</button>
            </div>
        </section>

        <section id="admin-area" style="display:none;">
            <div class="container">
                <h2 data-lang-de="Jahreskalender (Admin-Ansicht)" data-lang-en="Yearly Calendar (Admin View)">Jahreskalender (Admin-Ansicht)</h2>
                <div style="margin-bottom: 20px; text-align: center;">
                    <button id="btn-logout-admin" style="background-color: #f44336;"><i class="fas fa-sign-out-alt icon"></i> <span data-lang-de="Admin Logout" data-lang-en="Admin Logout">Admin Logout</span></button>
                    <button id="btn-export-csv"><i class="fas fa-file-csv icon"></i> <span data-lang-de="Exportiere Buchungen (CSV)" data-lang-en="Export Bookings (CSV)">Exportiere Buchungen (CSV)</span></button>
                </div>
                <div style="text-align:center; margin-bottom: 10px;">
                    <button id="admin-year-prev" data-lang-de="&lt; Vorjahr" data-lang-en="&lt; Previous Year">&lt; Vorjahr</button>
                    <span id="admin-year-display" style="font-weight: 700; margin: 0 15px; font-size: 1.2em;"></span>
                    <button id="admin-year-next" data-lang-de="Nächstes Jahr &gt;" data-lang-en="Next Year &gt;">Nächstes Jahr &gt;</button>
                </div>

                <div id="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-available"></div>
                        <span data-lang-de="Freie Tage" data-lang-en="Available Days">Freie Tage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-booked"></div>
                        <span data-lang-de="Gebuchte Tage" data-lang-en="Booked Days">Gebuchte Tage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-cancelled"></div>
                        <span data-lang-de="Storniert" data-lang-en="Cancelled">Storniert</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-blocked"></div>
                        <span data-lang-de="Blockierte Tage" data-lang-en="Blocked Days">Blockierte Tage</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-split"></div>
                        <span data-lang-de="Halbtags belegt" data-lang-en="Half-day booked">Halbtags belegt</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" id="legend-color-selected"></div>
                        <span data-lang-de="Ausgewählter Zeitraum" data-lang-en="Selected Period">Ausgewählter Zeitraum</span>
                    </div>
                </div>

                <div id="admin-yearly-calendar-content"></div>

                <div style="text-align: center; margin-top: 10px;">
                    <button id="btn-block-selected" style="background-color: #757575;" data-lang-de="Ausgewählte Tage blockieren" data-lang-en="Block Selected Days">Ausgewählte Tage blockieren</button>
                    <button id="btn-unblock-selected" style="background-color: #f44336;" data-lang-de="Ausgewählte Tage freigeben" data-lang-en="Unblock Selected Days">Ausgewählte Tage freigeben</button>
                </div>
                
                <div id="admin-booking-form-container" style="display:none;">
                    <h3 data-lang-de="Admin-Buchung oder Blockierung" data-lang-en="Admin Booking or Blocking">Admin-Buchung oder Blockierung</h3>
                    <form id="admin-booking-form">
                        <div>
                            <label for="admin-book-name" data-lang-de="Name (Pflichtfeld)" data-lang-en="Name (Required)">Name (Pflichtfeld)</label>
                            <input type="text" id="admin-book-name" required />
                        </div>
                        <div>
                            <label for="admin-book-email" data-lang-de="E-Mail (Pflichtfeld)" data-lang-en="Email (Required)">E-Mail (Pflichtfeld)</label>
                            <input type="email" id="admin-book-email" required />
                        </div>
                        <div>
                            <label for="admin-book-phone" data-lang-de="Mobilfunknummer (Pflichtfeld)" data-lang-en="Mobile Number (Required)">Mobilfunknummer (Pflichtfeld)</label>
                            <input type="tel" id="admin-book-phone" required />
                        </div>
                        <div>
                            <label for="admin-book-start-date" data-lang-de="Startdatum (Pflichtfeld)" data-lang-en="Start Date (Required)">Startdatum (Pflichtfeld)</label>
                            <input type="date" id="admin-book-start-date" required />
                        </div>
                        <div>
                            <label for="admin-book-end-date" data-lang-de="Enddatum (Pflichtfeld)" data-lang-en="End Date (Required)">Enddatum (Pflichtfeld)</label>
                            <input type="date" id="admin-book-end-date" required />
                        </div>
                        <button type="submit" data-lang-de="Buchung eintragen" data-lang-en="Add Booking">Buchung eintragen</button>
                        <button type="button" id="btn-cancel-admin-form" style="background-color: #f44336;" data-lang-de="Abbrechen" data-lang-en="Cancel">Abbrechen</button>
                    </form>
                </div>

                <div id="admin-edit-form-container" style="display:none;">
                    <h3 data-lang-de="Buchung bearbeiten" data-lang-en="Edit Booking">Buchung bearbeiten</h3>
                    <form id="admin-edit-form">
                        <input type="hidden" id="edit-booking-id" />
                        <div>
                            <label for="edit-name" data-lang-de="Name (Pflichtfeld)" data-lang-en="Name (Required)">Name (Pflichtfeld)</label>
                            <input type="text" id="edit-name" required />
                        </div>
                        <div>
                            <label for="edit-email" data-lang-de="E-Mail (Pflichtfeld)" data-lang-en="Email (Required)">E-Mail (Pflichtfeld)</label>
                            <input type="email" id="edit-email" required />
                        </div>
                        <div>
                            <label for="edit-phone" data-lang-de="Mobilfunknummer (Pflichtfeld)" data-lang-en="Mobile Number (Required)">Mobilfunknummer (Pflichtfeld)</label>
                            <input type="tel" id="edit-phone" required />
                        </div>
                        <div>
                            <label for="edit-persons" data-lang-de="Anzahl Personen (max. 3)" data-lang-en="Number of people (max. 3)">Anzahl Personen (max. 3)</label>
                            <input type="number" id="edit-persons" min="1" max="3" required />
                        </div>
                        <div>
                            <label for="edit-start-date" data-lang-de="Startdatum (Pflichtfeld)" data-lang-en="Start Date (Required)">Startdatum (Pflichtfeld)</label>
                            <input type="date" id="edit-start-date" required />
                        </div>
                        <div>
                            <label for="edit-end-date" data-lang-de="Enddatum (Pflichtfeld)" data-lang-en="End Date (Required)">Enddatum (Pflichtfeld)</label>
                            <input type="date" id="edit-end-date" required />
                        </div>
                        <div>
                            <label for="edit-breakfast" data-lang-de="Frühstück benötigt?" data-lang-en="Breakfast needed?">Frühstück benötigt?</label>
                            <select id="edit-breakfast" required>
                                <option value="ja" data-lang-de="Ja" data-lang-en="Yes">Ja</option>
                                <option value="nein" data-lang-de="Nein" data-lang-en="No">Nein</option>
                            </select>
                        </div>
                        <div>
                            <label for="edit-parking">
                                <input type="checkbox" id="edit-parking"> <span data-lang-de="Parkplatz benötigt?" data-lang-en="Parking space needed?">Parkplatz benötigt?</span>
                            </label>
                        </div>
                        <div>
                            <label for="edit-comment" data-lang-de="Bemerkungen (optional, max. 200 Zeichen)" data-lang-en="Comments (optional, max. 200 characters)">Bemerkungen (optional, max. 200 Zeichen)</label>
                            <textarea id="edit-comment" maxlength="200"></textarea>
                        </div>
                        <button type="submit" data-lang-de="Änderungen speichern" data-lang-en="Save Changes">Änderungen speichern</button>
                        <button type="button" id="btn-cancel-edit-form" style="background-color: #f44336;" data-lang-de="Abbrechen" data-lang-en="Cancel">Abbrechen</button>
                    </form>
                </div>


                <h3 data-lang-de="Belegte und Blockierte Tage" data-lang-en="Booked and Blocked Days">Belegte und Blockierte Tage</h3>
                <div id="admin-bookings-list"></div>
                
                <h3 data-lang-de="Warteliste" data-lang-en="Waitlist">Warteliste</h3>
                <div id="admin-waitlist-list"></div>

                <h3 data-lang-de="Statistiken" data-lang-en="Statistics">Statistiken</h3>
                <div id="stats-container" class="container">
                    <p><strong data-lang-de="Anzahl Buchungen (aktiv):" data-lang-en="Number of active bookings:">Anzahl Buchungen (aktiv):</strong> <span id="stat-active-bookings">0</span></p>
                    <p><strong data-lang-de="Anzahl stornierter Buchungen:" data-lang-en="Number of cancelled bookings:">Anzahl stornierter Buchungen:</strong> <span id="stat-cancelled-bookings">0</span></p>
                    <p><strong data-lang-de="Durchschnittliche Aufenthaltsdauer:" data-lang-en="Average stay duration:">Durchschnittliche Aufenthaltsdauer:</strong> <span id="stat-avg-stay">0</span> <span data-lang-de="Tage" data-lang-en="days">Tage</span></p>
                    <p><strong data-lang-de="Auslastung im aktuellen Jahr:" data-lang-en="Occupancy in current year:">Auslastung im aktuellen Jahr:</strong> <span id="stat-occupancy">0%</span></p>
                </div>
            </div>
        </section>

        <section id="cancel-page" style="display:none; text-align: center; padding: 50px;">
            <div class="container confirmation-box error">
                <h2 data-lang-de="Buchung stornieren" data-lang-en="Cancel Booking">Buchung stornieren</h2>
                <p id="cancel-status-text" data-lang-de="Stornierungslink wird überprüft..." data-lang-en="Cancellation link is being checked...">Stornierungslink wird überprüft...</p>
                <div id="cancel-details" class="details" style="margin: 20px auto;"></div>
                <div id="cancel-buttons" class="button-group">
                    <button id="btn-confirm-cancellation" style="background-color: #f44336;" data-lang-de="Buchung bestätigen & stornieren" data-lang-en="Confirm & Cancel Booking">Buchung bestätigen & stornieren</button>
                    <button id="btn-return-home" data-lang-de="Zurück zur Startseite" data-lang-en="Back to homepage">Zurück zur Startseite</button>
                </div>
            </div>
        </section>
        
        <section id="waitlist-success" style="display:none; text-align: center; padding: 50px;">
            <div class="container confirmation-box">
                <h3 data-lang-de="Warteliste-Eintrag erfolgreich!" data-lang-en="Waitlist entry successful!">Warteliste-Eintrag erfolgreich!</h3>
                <p data-lang-de="Ihre Daten wurden auf der Warteliste gespeichert. Wir benachrichtigen Sie, wenn der gewünschte Zeitraum frei wird." data-lang-en="Your details have been saved on the waitlist. We will notify you if the desired period becomes available."></p>
                <div class="button-group">
                    <button id="btn-return-home-from-waitlist" data-lang-de="Zurück zur Startseite" data-lang-en="Back to homepage">Zurück zur Startseite</button>
                </div>
            </div>
        </section>

    </main>

    <script>
        (() => {
            const FRIEND_PASSWORD = "ÜinOffenbach!";
            const ADMIN_PASSWORD = "Romulus2025?!";
            const ADMIN_EMAIL = "pauldippmann@gmail.com";

            const EMAILJS_SERVICE_ID = 'service_9vdk8p2';
            const EMAILJS_TEMPLATE_ID_BOOKING = 'template_exo2yi1';
            const EMAILJS_TEMPLATE_ID_CANCEL = 'template_9azx5z9';
            const EMAILJS_TEMPLATE_ID_REMINDER = 'template_9azx5z9';
            const EMAILJS_PUBLIC_KEY = 'OXLiZSAem79gPP-Wl';

            const firebaseConfig = {
                apiKey: "AIzaSyAu9hXGYbgmD-_pz0LHN5VgUcV9mRNkU98",
                authDomain: "freunde-kalender-offenbach.firebaseapp.com",
                projectId: "freunde-kalender-offenbach",
                storageBucket: "freunde-kalender-offenbach.firebasestorage.app",
                messagingSenderId: "753671032354",
                appId: "1:753671032354:web:a154b43ccdfcc491c4c47b"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            const CAL_START_YEAR = 2025;
            const CAL_END_YEAR = 2040;

            let currentYear;
            let selectedStartDate = null;
            let selectedEndDate = null;
            let currentView = 'friend';
            let currentLang = 'de';
            let lastBookedDates = { startDate: null, endDate: null };
            let editBookingData = null;

            const sections = {
                start: document.getElementById("start-page"),
                friendArea: document.getElementById("friend-area"),
                adminLogin: document.getElementById("admin-login"),
                adminArea: document.getElementById("admin-area"),
                cancel: document.getElementById("cancel-page"),
                waitlistSuccess: document.getElementById("waitlist-success")
            };

            const translations = {
                de: {
                    'Willkommen in Offenbach!': 'Willkommen in Offenbach!',
                    'Ich freue mich auf deinen Besuch! Über den Kalender kannst du als Gast bequem eine Übernachtung buchen. Oder du meldest dich als Admin an, um den Kalender zu verwalten.': 'Ich freue mich auf deinen Besuch! Über den Kalender kannst du als Gast bequem eine Übernachtung buchen. Oder du meldest dich als Admin an, um den Kalender zu verwalten.',
                    'Hier geht es zur Buchung': 'Hier geht es zur Buchung',
                    'Admin Login': 'Admin Login',
                    'Startseite': 'Startseite',
                    'Homepage': 'Startseite',
                    'Bitte Passwort eingeben:': 'Bitte Passwort eingeben:',
                    'Passwort': 'Passwort',
                    'Einloggen': 'Einloggen',
                    'Falsches Passwort!': 'Falsches Passwort!',
                    'Jahreskalender (Gast-Ansicht)': 'Jahreskalender (Gast-Ansicht)',
                    'Jahreskalender (Admin-Ansicht)': 'Jahreskalender (Admin-Ansicht)',
                    '&lt; Vorjahr': '&lt; Vorjahr',
                    'Nächstes Jahr &gt;': 'Nächstes Jahr &gt;',
                    'Freie Tage': 'Freie Tage',
                    'Gebuchte Tage (ganztägig)': 'Gebuchte Tage (ganztägig)',
                    'Halbtags belegt': 'Halbtags belegt',
                    'Gebuchte Tage': 'Gebuchte Tage',
                    'Blockierte Tage': 'Blockierte Tage',
                    'Ausgewählter Zeitraum': 'Ausgewählter Zeitraum',
                    'Buchungsdetails': 'Buchungsdetails',
                    'Buchung von': 'Buchung von',
                    'bis': 'bis',
                    'Name (Pflichtfeld)': 'Name (Pflichtfeld)',
                    'E-Mail-Adresse (Pflichtfeld)': 'E-Mail-Adresse (Pflichtfeld)',
                    'Mobilfunknummer (Pflichtfeld)': 'Mobilfunknummer (Pflichtfeld)',
                    'Anzahl Personen (max. 3)': 'Anzahl Personen (max. 3)',
                    'Startdatum': 'Startdatum',
                    'Enddatum': 'Enddatum',
                    'Frühstück benötigt?': 'Frühstück benötigt?',
                    'Ja': 'Ja',
                    'Nein': 'Nein',
                    'Anreise Uhrzeit (optional)': 'Anreise Uhrzeit (optional)',
                    'Abreise Uhrzeit (optional)': 'Abreise Uhrzeit (optional)',
                    'Bemerkungen (optional, max. 200 Zeichen)': 'Bemerkungen (optional, max. 200 Zeichen)',
                    'Parkplatz benötigt?': 'Parkplatz benötigt?',
                    'Buchung abschicken': 'Buchung abschicken',
                    'Abbrechen': 'Abbrechen',
                    'Bitte einen Namen eingeben.': 'Bitte einen Namen eingeben.',
                    'Bitte eine gültige E-Mail-Adresse eingeben.': 'Bitte eine gültige E-Mail-Adresse eingeben.',
                    'Bitte gültige Anzahl Personen eingeben (max. 3).': 'Bitte gültige Anzahl Personen eingeben (max. 3).',
                    'Bitte gültige Start- und Enddaten eingeben.': 'Bitte gültige Start- und Enddaten eingeben.',
                    'Enddatum darf nicht vor Startdatum liegen.': 'Enddatum darf nicht vor Startdatum liegen.',
                    'Der ausgewählte Zeitraum überschneidet sich mit einem blockierten Zeitraum.': 'Der ausgewählte Zeitraum überschneidet sich mit einem blockierten Zeitraum.',
                    'Der ausgewählte Zeitraum überschneidet sich mit einer bestehenden Buchung.': 'Der ausgewählte Zeitraum überschneidet sich mit einer bestehenden Buchung.',
                    'Buchung erfolgreich!': 'Buchung erfolgreich!',
                    'Ihre Buchungsdetails wurden gespeichert. Sie erhalten in Kürze eine Bestätigung per E-Mail.': 'Ihre Buchungsdetails wurden gespeichert. Sie erhalten in Kürze eine Bestätigung per E-Mail.',
                    'Neue Buchung': 'Neue Buchung',
                    'Zurück zur Startseite': 'Zurück zur Startseite',
                    'Admin Passwort': 'Admin Passwort',
                    'Falsches Admin-Passwort!': 'Falsches Admin-Passwort!',
                    'Admin Logout': 'Admin Logout',
                    'Exportiere Buchungen (CSV)': 'Exportiere Buchungen (CSV)',
                    'Storniert': 'Storniert',
                    'Ausgewählte Tage blockieren': 'Ausgewählte Tage blockieren',
                    'Ausgewählte Tage freigeben': 'Ausgewählte Tage freigeben',
                    'Admin-Buchung oder Blockierung': 'Admin-Buchung oder Blockierung',
                    'Name': 'Name',
                    'E-Mail': 'E-Mail',
                    'Startdatum': 'Startdatum',
                    'Enddatum': 'Enddatum',
                    'Buchung eintragen': 'Buchung eintragen',
                    'Bitte wähle zuerst einen Zeitraum im Kalender aus.': 'Bitte wähle zuerst einen Zeitraum im Kalender aus.',
                    'Zeitraum von %s bis %s erfolgreich blockiert.': 'Zeitraum von %s bis %s erfolgreich blockiert.',
                    'Sollen die Tage von %s bis %s wirklich freigegeben werden?': 'Sollen die Tage von %s bis %s wirklich freigegeben werden?',
                    'Tage erfolgreich freigegeben!': 'Tage erfolgreich freigegeben!',
                    'Keine Blockierung im ausgewählten Zeitraum gefunden.': 'Keine Blockierung im ausgewählten Zeitraum gefunden.',
                    'Belegte und Blockierte Tage': 'Belegte und Blockierte Tage',
                    'Statistiken': 'Statistiken',
                    'Anzahl Buchungen (aktiv):': 'Anzahl Buchungen (aktiv):',
                    'Anzahl stornierter Buchungen:': 'Anzahl stornierter Buchungen:',
                    'Durchschnittliche